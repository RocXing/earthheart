<!DOCTYPE html>
<html style="height: 100%">
   <head>
       <meta charset="utf-8">
   </head>
   <body style="height: 100%; margin: 0; background: black">
       <div id="container" style="height: 100%;"></div>
       <!--<div id="container" style="height: 100%; width: 50%"></div>-->
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
       <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
       <script type="text/javascript">
let dom = document.getElementById("container");
let myChart = echarts.init(dom);
let loadingOps = {
    text: 'Initializing....',
    color: '#FFF',
    textColor: '#FFF',
    maskColor: 'rgba(0, 0, 0, 1)',
    zlevel: 0
};
myChart.showLoading(loadingOps);

let baseTexture = new Image();
let heightTexture = new Image();
let environment = new Image();
baseTexture.onload =()=>{
    oneImgFinish();
};
heightTexture.onload= () => {
    oneImgFinish();
};
environment.onload = () => {
    oneImgFinish();
};
let baseTextureUrl = "data-gl/asset/world.topo.bathy.200401.jpg";
let heightTextureUrl = "data-gl/asset/bathymetry_bw_composite_4k.jpg";
let environmentUrl = 'data-gl/asset/starfield.jpg';
baseTexture.src = baseTextureUrl;
heightTexture.src = heightTextureUrl;
environment.src = environmentUrl;
myChart.setOption(getDefaultOption(),true);
let populationData = null;
let imgCounter = 0;
$.getJSON('data-gl/asset/data/population.json', function (data) {
    populationData = data.filter(function (dataItem) {
        return dataItem[2] > 0;
    }).map(function (dataItem) {
        return [dataItem[0], dataItem[1], Math.sqrt(dataItem[2])];
    });
    oneImgFinish();
});

function oneImgFinish() {
    imgCounter++;
    if (imgCounter >=4){
        myChart.hideLoading();
    }
}

let toolClicked = false;
function onViewToolClick() {
    if (!toolClicked) {
        let opt = getDefaultOption();
        opt.series.push({
            type: 'scatter3D',
            coordinateSystem: 'globe',
            blendMode: 'lighter',
            symbolSize: 2,
            silent: true,
            itemStyle: {
                color: 'rgb(75, 5, 5)',
                opacity: 0.8
            },
            data: populationData
        });
        opt.series.push({
            type: 'scatter3D',
            coordinateSystem: 'globe',
            blendMode: 'lighter',
            symbolSize: 5,
            silent: true,
            itemStyle: {
                color: 'rgb(100, 0, 0)',
                opacity: 1,
                borderWidth:0.5,
                borderColor: 'rgb(75, 5, 5)',
            },
            data: getHeartPointData()
        });
        opt.series.push({
            type: 'scatter3D',
            coordinateSystem: 'globe',
            blendMode: 'lighter',
            symbol: "path://M4660 10748 c0 -3 20 -50 44 -105 91 -204 184 -489 271 -830 65 -251 73 -309 90 -665 36 -751 87 -1014 239 -1242 61 -91 234 -287 320 -362 31 -27 56 -54 56 -61 0 -7 -17 -15 -37 -18 -153 -25 -362 -112 -483 -200 -182 -134 -434 -382 -568 -560 -95 -127 -171 -260 -209 -370 -25 -72 -28 -93 -28 -216 l0 -136 42 -85 c75 -150 236 -282 460 -377 l99 -42 53 -162 c29 -89 68 -198 86 -242 43 -103 50 -131 33 -137 -18 -6 -501 8 -781 23 -439 23 -673 -10 -923 -132 -238 -116 -417 -281 -658 -604 -286 -383 -718 -859 -1370 -1511 -362 -361 -515 -500 -652 -591 -30 -20 -53 -38 -51 -39 2 -2 37 3 78 11 41 8 142 18 224 21 224 10 443 -18 685 -86 204 -58 255 -65 455 -64 193 0 292 14 452 60 192 55 311 136 445 300 65 81 121 110 233 119 266 23 519 169 674 390 99 142 181 202 326 240 85 23 293 29 555 17 222 -11 317 -23 685 -92 61 -12 174 -24 252 -27 133 -5 144 -4 189 17 38 19 52 21 73 13 14 -6 86 -36 158 -66 73 -31 221 -86 328 -123 114 -39 194 -72 192 -78 -8 -25 -374 -102 -711 -151 -382 -54 -824 -78 -1070 -56 -71 6 -131 9 -134 7 -6 -6 178 -62 353 -107 331 -84 462 -91 760 -41 291 48 348 55 510 54 182 0 253 -13 437 -81 76 -28 165 -58 199 -68 33 -9 63 -23 66 -30 3 -7 -4 -35 -15 -61 -11 -26 -44 -128 -72 -227 -112 -388 -194 -537 -359 -647 -99 -66 -326 -294 -464 -467 -59 -74 -105 -136 -103 -138 2 -3 37 13 78 35 113 62 160 72 373 83 291 14 404 43 571 150 43 28 169 94 279 147 110 53 274 134 365 179 l165 82 50 -34 c50 -34 125 -58 285 -92 62 -13 129 -18 245 -17 143 0 166 2 218 23 152 60 226 174 348 529 47 137 35 128 164 136 47 3 162 26 280 56 252 63 348 77 435 62 63 -11 95 -25 280 -124 326 -175 1271 -398 1682 -398 64 0 71 14 12 25 -69 12 -204 63 -289 109 -47 24 -165 101 -263 169 -377 264 -444 298 -682 341 -246 45 -425 96 -567 161 -77 36 -93 59 -45 69 15 3 97 17 184 30 498 78 848 52 991 -74 33 -29 42 -32 77 -26 103 16 230 97 374 235 223 217 335 431 336 642 0 119 -51 269 -133 388 -47 69 -164 187 -254 258 -94 73 -260 177 -310 194 -18 6 -33 16 -33 22 0 7 48 115 107 240 l108 228 97 79 c293 241 402 413 429 684 14 139 7 208 -29 294 -110 256 -325 499 -573 645 -63 37 -74 48 -77 73 -27 308 -166 623 -365 826 -259 266 -658 418 -1094 418 -92 0 -117 -4 -196 -31 -88 -30 -94 -31 -161 -20 -212 35 -466 165 -708 362 -147 120 -257 174 -457 224 -162 41 -296 57 -526 64 l-219 6 -14 50 c-98 370 -160 543 -287 800 -230 466 -457 711 -845 913 -254 133 -455 187 -852 232 -297 33 -394 67 -538 191 -126 108 -391 339 -422 367 -16 14 -28 23 -28 20z",
            symbolSize: 20,
            silent: true,
            itemStyle: {
                color: 'rgb(100, 0, 0)',
                opacity: 1,
                borderWidth: 1,
                borderColor: 'rgb(75, 5, 5)',
            },
            data: [[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30],[0, 0, 30]]

        });
        myChart.setOption(opt, true);
        toolClicked = true;
    }

}

function getDefaultOption() {
    return {
        backgroundColor: '#000',
        visualMap:{
            show: false,
            min: 0,
            max: 60,
            inRange: {
                symbolSize: [1.0, 10.0]
            }
        },
        globe: {
            globeRadius: 60,
            globeOuterRadius: 60,
            baseTexture: baseTextureUrl,
            heightTexture: heightTextureUrl,
            displacementScale: 0.15,
            shading: 'realistic',
            environment: environmentUrl,
            realisticMaterial: {
                textureTiling: [8, 4]
            },
            postEffect: {
                enable: true
            },
            viewControl: {
                autoRotate: true,
                autoRotateSpeed: 7.5,
                autoRotateAfterStill: 0.5,
                targetCoord: [0, 0]
            },
            light: {
                main: {
                    intensity: 1.5,
                    shadow: true
                },
                ambientCubemap: {
                    texture: 'data-gl/asset/pisa.hdr',
                    exposure: 1,
                    diffuseIntensity: 1,
                    specularIntensity: 1
                },
            }
        },
        toolbox: {
            right: 40,
            top: 10,
            itemSize: 25,
            feature: {
                myTool1: {
                    show: true,
                    title: 'For Miss Shang',
                    icon: 'path://M432.45,595.444c0,2.177-4.661,6.82-11.305,6.82c-6.475,0-11.306-4.567-11.306-6.82s4.852-6.812,11.306-6.812C427.841,588.632,432.452,593.191,432.45,595.444L432.45,595.444z M421.155,589.876c-3.009,0-5.448,2.495-5.448,5.572s2.439,5.572,5.448,5.572c3.01,0,5.449-2.495,5.449-5.572C426.604,592.371,424.165,589.876,421.155,589.876L421.155,589.876z M421.146,591.891c-1.916,0-3.47,1.589-3.47,3.549c0,1.959,1.554,3.548,3.47,3.548s3.469-1.589,3.469-3.548C424.614,593.479,423.062,591.891,421.146,591.891L421.146,591.891zM421.146,591.891',
                    onclick: onViewToolClick
                },
            }
        },
        series: [
            {
                type: 'scatter',
                data: [[0,0]],
                symbolSize: 1,
                label: {
                    normal: {
                        show: true,
                        position: [-650, -200],
                        formatter: [
                            '再见，太阳系...',
                            'さようなら、太陽系...',
                            'Goodbye, the Solar System...',
                            'Прощай солнечная система...',
                            'Au revoir, le système solaire...',
                        ].join('\n'),
                        padding: 10,
                        color: '#FFF',
                        fontFamily: '华文细黑,微软雅黑',
                        fontSize: 20,
                        shadowBlur: 3,
                        shadowColor: '#888',
                        shadowOffsetX: 0,
                        shadowOffsetY: 3,
                        lineHeight: 40,
                    },
                }
            },
            {
                type: 'scatter',
                data: [[0,0]],
                symbolSize: 1,
                label: {
                    normal: {
                        show: true,
                        position: [425, -200],
                        formatter: [
                            '无论地球去哪里流浪',
                            '我都愿意和你在一起',
                            '\n',
                            '——《流浪地球法案》'
                        ].join('\n'),
                        padding: 10,
                        color: '#FFF',
                        fontFamily: '华文细黑',
                        fontSize: 20,
                        shadowBlur: 3,
                        shadowColor: '#888',
                        shadowOffsetX: 0,
                        shadowOffsetY: 3,
                        lineHeight: 30,
                    },
                }
            }

        ],
        xAxis: {
            axisLabel: {show: false},
            axisLine: {show: false},
            splitLine: {show: false},
            axisTick: {show: false},
            min: -1,
            max: 1
        },
        yAxis: {
            axisLabel: {show: false},
            axisLine: {show: false},
            splitLine: {show: false},
            axisTick: {show: false},
            min: -1,
            max: 1
        }

    };
}

function getHeartPointData() {

    let data = [];
    for (let scale = 0.9; scale <= 1.0; scale += 0.025) {
        for (let step = 0.008; step <= 0.01; step += 0.001) {
            for (let t = -3; t <= 3; t = t + step) {
                let x = 16 * Math.pow(Math.sin(t), 3);
                let y = 13 * Math.cos(t) - 5 * Math.cos(t * 2) - 2 * Math.cos(t * 3) - Math.cos(t * 4);
                //增大心
                x = x * scale;
                y = y * scale;
                data.push([x, y, 10]);
            }
        }
    }
    return data;

}

       </script>
   </body>
</html>